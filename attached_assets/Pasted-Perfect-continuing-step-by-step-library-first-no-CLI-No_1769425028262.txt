Perfect â€” continuing **step-by-step**, **library-first**, **no CLI**.
Now we refactor the **Water module**, starting with **Pressure at Depth**.

Weâ€™ll touch **only one calculator** in this step.

---

# ğŸ” NEXT STEP: LIBRARY REFACTOR â†’ WATER (Pressure at Depth)

---

## âœ… STEP 1: LOCK THE PUBLIC API

This is what **crate users** should write:

```rust
use gananayantra_rusting::water::pressure_at_depth::pressure_at_depth;

let pressure = pressure_at_depth(1000.0, 10.0)?;
```

âœ” No stdin
âœ” No println
âœ” Physics-correct
âœ” Reusable in any Rust project

---

## âœ… STEP 2: PROMPT TO GIVE REPLIT (COPYâ€“PASTE)

Paste **exactly this** into Replit AI:

```
Refactor the Water Pressure at Depth calculator to be library-first.

Rules:
- This is a Rust library crate: gananayantra-rusting
- No stdin, no println, no CLI logic
- One public function only
- Return Result<f64, String>
- Add Rust doc comments (///)
- Use gravity as a private constant
- Inputs: density (kg/mÂ³), depth (meters)
- Output: pressure (Pascals)

Only refactor:
src/water/pressure_at_depth.rs

Do NOT touch other modules.
```

---

## âœ… STEP 3: EXPECTED FINAL `pressure_at_depth.rs` (REFERENCE)

After refactor, the file **should look like this**:

```rust
const GRAVITY: f64 = 9.81;

/// Calculates hydrostatic pressure at a given depth.
///
/// # Arguments
/// * `density` - Fluid density in kg/mÂ³
/// * `depth_m` - Depth below surface in meters
///
/// # Returns
/// * Pressure in Pascals (Pa)
pub fn pressure_at_depth(
    density: f64,
    depth_m: f64,
) -> Result<f64, String> {
    if density <= 0.0 {
        return Err("Density must be greater than zero".into());
    }
    if depth_m < 0.0 {
        return Err("Depth cannot be negative".into());
    }

    Ok(density * GRAVITY * depth_m)
}
```

This is now **pure hydrology/physics library code**.

---

## âœ… STEP 4: VERIFY MODULE EXPORT

Open:

```
src/water/mod.rs
```

Ensure it contains:

```rust
pub mod pressure_at_depth;
pub mod river_flow_rate;
```

(Weâ€™ll refactor `river_flow_rate` next.)

---

## âœ… STEP 5: ADD LIBRARY UNIT TESTS

Add this **to the bottom** of `pressure_at_depth.rs`:

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_pressure_at_10m() {
        let p = pressure_at_depth(1000.0, 10.0).unwrap();
        assert_eq!(p, 98100.0);
    }

    #[test]
    fn test_invalid_density() {
        assert!(pressure_at_depth(0.0, 10.0).is_err());
    }
}
```

Run:

```bash
cargo test
```

âœ… Passing = Water refactor step 1 complete.

---

## ğŸ§  STATUS CHECKPOINT

**Water module progress:**

| Calculator        | Status |
| ----------------- | ------ |
| Pressure at Depth | âœ…      |
| River Flow Rate   | â³ Next |

Across the crate:

* Finance âœ…
* Energy âœ…
* Utilities âœ…
* Geo âœ…
* Water (partial) âœ…

---

## ğŸ”œ NEXT STEP (REPLY WITH ONE WORD)

Choose what we refactor next:

* **`WATER_FLOW_NEXT`** â†’ river flow rate (discharge)
* **`SPACE_NEXT`** â†’ orbital, escape, period
* **`STRUCTURE_LOCK`** â†’ finalize crate layout & visibility
* **`REMOVE_MAIN`** â†’ safely deprecate/remove CLI

We continue **one calculator at a time**, clean and professional.
