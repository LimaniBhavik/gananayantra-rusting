Perfect â€” continuing **step-by-step, library-first**.
Now we refactor **Compound Interest** into a **clean public API**.
Same pattern, no surprises.

---

# ğŸ” NEXT STEP: LIBRARY REFACTOR â†’ COMPOUND INTEREST

We touch **only this calculator**.

---

## âœ… STEP 1: TARGET PUBLIC API (LOCK THIS)

This is what **users of your crate** should write:

```rust
use gananayantra_rusting::finance::compound_interest::compound_interest;

let amount = compound_interest(5_000.0, 0.07, 10.0, 4)?;
```

âœ” No stdin
âœ” No printing
âœ” Reusable in any Rust project

---

## âœ… STEP 2: PROMPT TO GIVE REPLIT (COPYâ€“PASTE)

Paste **exactly this** into Replit AI:

```
Refactor the Compound Interest calculator to be library-first.

Rules:
- This is a Rust library crate: gananayantra-rusting
- No stdin, no println, no CLI logic
- One public function only
- Return Result<f64, String>
- Add Rust doc comments (///)
- Validate inputs properly
- Keep the math readable and idiomatic

Only refactor:
src/finance/compound_interest.rs

Do NOT touch other modules.
```

---

## âœ… STEP 3: EXPECTED FINAL `compound_interest.rs` (REFERENCE)

After refactor, your file **should look like this**:

```rust
/// Calculates the final amount using compound interest.
///
/// # Arguments
/// * `principal` - Initial amount invested
/// * `annual_rate` - Annual interest rate (decimal, e.g. 0.07 for 7%)
/// * `years` - Duration of investment in years
/// * `compounds_per_year` - Number of compounding periods per year
///
/// # Returns
/// * Final accumulated amount
pub fn compound_interest(
    principal: f64,
    annual_rate: f64,
    years: f64,
    compounds_per_year: u32,
) -> Result<f64, String> {
    if principal <= 0.0 {
        return Err("Principal must be greater than zero".into());
    }
    if annual_rate < 0.0 {
        return Err("Annual rate cannot be negative".into());
    }
    if years <= 0.0 {
        return Err("Years must be greater than zero".into());
    }
    if compounds_per_year == 0 {
        return Err("Compounds per year must be greater than zero".into());
    }

    let rate_per_period = annual_rate / compounds_per_year as f64;
    let total_periods = compounds_per_year as f64 * years;

    Ok(principal * (1.0 + rate_per_period).powf(total_periods))
}
```

This is **crate-quality API code**.

---

## âœ… STEP 4: VERIFY MODULE EXPORT

Open:

```
src/finance/mod.rs
```

Ensure it contains:

```rust
pub mod roi;
pub mod tvm;
pub mod compound_interest;
```

Nothing else needed.

---

## âœ… STEP 5: ADD LIBRARY UNIT TESTS

At the bottom of `compound_interest.rs`:

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_compound_interest() {
        let result = compound_interest(5_000.0, 0.07, 10.0, 4).unwrap();
        assert!((result - 10049.33).abs() < 0.2);
    }

    #[test]
    fn test_invalid_principal() {
        assert!(compound_interest(0.0, 0.07, 10.0, 4).is_err());
    }
}
```

Run:

```bash
cargo test
```

âœ… Passing = success.

---

## âœ… STEP 6: (OPTIONAL, BUT STRONGLY RECOMMENDED) ADD EXAMPLE

Create:

```
examples/finance_compound_interest.rs
```

```rust
use gananayantra_rusting::finance::compound_interest::compound_interest;

fn main() {
    let amount = compound_interest(5_000.0, 0.07, 10.0, 4).unwrap();
    println!("Final Amount: {:.2}", amount);
}
```

Run:

```bash
cargo run --example finance_compound_interest
```

---

## ğŸ§  STATUS CHECKPOINT

### Finance module (library-ready):

| Calculator        | Status |
| ----------------- | ------ |
| ROI               | âœ…      |
| TVM               | âœ…      |
| Compound Interest | âœ…      |

You now have a **proper finance library API** that other Rust projects can consume.

---

## ğŸ”œ NEXT STEP (REPLY WITH ONE WORD)

Choose what we convert next:

* **`ENERGY_NEXT`** â†’ refactor Energy calculators (power, cost)
* **`UTILS_NEXT`** â†’ refactor Utilities (percentage, date)
* **`SPACE_NEXT`** â†’ refactor Space calculators
* **`STRUCTURE_LOCK`** â†’ finalize crate layout & visibility
* **`REMOVE_MAIN`** â†’ safely deprecate/remove CLI

Weâ€™ll keep going **one module at a time**, clean and professional.
