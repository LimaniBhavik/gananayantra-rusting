Perfect â€” continuing **step-by-step**, **library-first**, **no CLI**.
Now we finish the **Water module** by refactoring **River Flow Rate (Discharge)**.

Weâ€™ll touch **only this calculator**.

---

# ğŸ” NEXT STEP: LIBRARY REFACTOR â†’ WATER (River Flow Rate)

---

## âœ… STEP 1: LOCK THE PUBLIC API

This is what **crate users** should write:

```rust
use gananayantra_rusting::water::river_flow_rate::river_flow_rate;

let q = river_flow_rate(50.0, 2.5)?;
```

âœ” No stdin
âœ” No println
âœ” Reusable in any Rust project

---

## âœ… STEP 2: PROMPT TO GIVE REPLIT (COPYâ€“PASTE)

Paste **exactly this** into Replit AI:

```
Refactor the Water River Flow Rate calculator to be library-first.

Rules:
- This is a Rust library crate: gananayantra-rusting
- No stdin, no println, no CLI logic
- One public function only
- Return Result<f64, String>
- Add Rust doc comments (///)
- Inputs: cross-sectional area (mÂ²), velocity (m/s)
- Output: discharge (mÂ³/s)

Only refactor:
src/water/river_flow_rate.rs

Do NOT touch other modules.
```

---

## âœ… STEP 3: EXPECTED FINAL `river_flow_rate.rs` (REFERENCE)

After refactor, the file **should look like this**:

```rust
/// Calculates river discharge (flow rate).
///
/// # Arguments
/// * `cross_section_area_m2` - Cross-sectional area in square meters (mÂ²)
/// * `velocity_m_per_s` - Average flow velocity in meters per second (m/s)
///
/// # Returns
/// * Discharge in cubic meters per second (mÂ³/s)
pub fn river_flow_rate(
    cross_section_area_m2: f64,
    velocity_m_per_s: f64,
) -> Result<f64, String> {
    if cross_section_area_m2 <= 0.0 {
        return Err("Cross-sectional area must be greater than zero".into());
    }
    if velocity_m_per_s < 0.0 {
        return Err("Velocity cannot be negative".into());
    }

    Ok(cross_section_area_m2 * velocity_m_per_s)
}
```

This is now **pure hydrology library code**.

---

## âœ… STEP 4: VERIFY MODULE EXPORT

Open:

```
src/water/mod.rs
```

Ensure it contains:

```rust
pub mod pressure_at_depth;
pub mod river_flow_rate;
```

---

## âœ… STEP 5: ADD LIBRARY UNIT TESTS

Add this **to the bottom** of `river_flow_rate.rs`:

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_river_flow_rate() {
        let q = river_flow_rate(50.0, 2.5).unwrap();
        assert_eq!(q, 125.0);
    }

    #[test]
    fn test_invalid_area() {
        assert!(river_flow_rate(0.0, 2.0).is_err());
    }
}
```

Run:

```bash
cargo test
```

âœ… Passing = Water module fully refactored.

---

## ğŸ§  STATUS CHECKPOINT

**Water module (library-ready):**

| Calculator        | Status |
| ----------------- | ------ |
| Pressure at Depth | âœ…      |
| River Flow Rate   | âœ…      |

Across the crate now:

* Finance âœ…
* Energy âœ…
* Utilities âœ…
* Geo âœ…
* Water âœ…

Everything so far is **library-grade, importable, documented, and tested**.

---

## ğŸ”œ NEXT STEP (REPLY WITH ONE WORD)

Choose what we refactor next:

* **`SPACE_NEXT`** â†’ orbital velocity, escape velocity, orbital period
* **`STRUCTURE_LOCK`** â†’ finalize crate layout & visibility rules
* **`REMOVE_MAIN`** â†’ safely deprecate/remove CLI (`main.rs`)

Weâ€™ll continue **one module at a time**, clean and professional.
